<html>
    <head>
        <style>

            body {
                background-image: url('https://i2.wp.com/balanced.training/wp-content/uploads/2016/11/Gym-Background.jpg?ssl=1');
                background-size: cover;
            }

            table, th, td {
            border: 1px solid black;
            }
           
        </style>
        <body>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        
        <div id="create-update" style="display: none">
            <h2>Create-Edit</h2>
            <table id="createUpdateForm">
                <tr>
                   <td>ISBN</td>
                   <td><inPut type = "text" name="ISBN" id ="idInput"></td>
                </tr>
                <tr>
                   <td>title</td>
                   <td><inPut type = "text" name="title"></td>
                </tr>
                <tr>
                   <td>author</td>
                   <td><inPut type = "text" name="author"></td>
                </tr>
                <tr>
                   <td>price</td>
                   <td><inPut type = "currency" name="price"></td>
                </tr>
                <tr>
                   <td></td><td><button id ="create-button" onclick="doCreate()">Create</button></td>
                   <td></td><td><button id ="update-button" onclick="doUpdate()">Update</button></td>
                </tr>
            </table>  
        </div> 
         <div id="display">
             <h2>Books</h2>
             <button onclick="showCreate()">Create</button>
             <table id = "bookTable" style="width:70%">
                <tr>
                    <th>ISBN</th><th>Title</th><th>author</th><th>price</th><th><th></th></th>
                </tr>
                
            </table>
         </div> 
         <script>
             function showCreate(){
                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "none"
                document.getElementById('create-button').style.display = "block"
                document.getElementById('create-update').style.display = "block"
             }


             function showUpdate(thisElem){
                var rowElement = thisElem.parentNode.parentNode;
                book = readBookFromRow(rowElement)
                populateForm(book)
                
                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "block"
                document.getElementById('create-button').style.display = "none"
                document.getElementById('create-update').style.display = "block"
             }
    

             function readBookFromRow(rowElement){
                book={}
                book.ISBN = rowElement.getAttribute("id");
                book.title = rowElement.cells[1].firstChild.textContent
                book.author = rowElement.cells[2].firstChild.textContent
                book.price = rowElement.cells[3].firstChild.textContent
                return book
             }


            function doUpdate(){
                book = getBookFromForm()
                updateServer(book)              
            }


            function updateServer(book){
                $.ajax({
                    url:'http://127.0.0.1:5000/books/'+book.ISBN,
                    data:JSON.stringify(book),
                    method:'PUT',
                    dataType:'JSON',
                    contentType:"application/json; charset=utf-8",
                    success:function(results){
                        console.log("update", results)
                        updateTableRow(book)
                        showDisplay()
                        clearForm()
                    },
                    error:function(xhr, status, error){
                            console.log("error"+error)
                    }
                }
                )       
            }


            function updateTableRow(book){
                rowElement = document.getElementById(book.ISBN)
                rowElement.cells[1].firstChild.textContent = book.title
                rowElement.cells[2].firstChild.textContent = book.author
                rowElement.cells[3].firstChild.textContent = book.price
            }


             function populateForm(book){
                var form = document.getElementById('createUpdateForm')
                form.querySelector('input[name="ISBN"]').value = book.ISBN
                form.querySelector('input[name="ISBN"]').disabled = true
                form.querySelector('input[name="title"]').value = book.title
                form.querySelector('input[name="author"]').value = book.author
                form.querySelector('input[name="price"]').value = book.price
             }


             function clearForm(){
                var form = document.getElementById('createUpdateForm')
                form.querySelector('input[name="ISBN"]').value = ''
                form.querySelector('input[name="ISBN"]').disabled = false
                form.querySelector('input[name="title"]').value = ''
                form.querySelector('input[name="author"]').value = ''
                form.querySelector('input[name="price"]').value = ''
             }

             function doCreate(){
                book = getBookFromForm()
                $.ajax({
                    url:'http://127.0.0.1:5000/books',
                    data:JSON.stringify(book),
                    method:'POST',
                    dataType:'JSON',
                    contentType:"application/json; charset=utf-8",
                    success:function(results){
                        addbookToTable(book)
                        showDisplay()
                        clearForm()
                    },
                    error:function(xhr, ststus, error){
                            console.log("error"+error)
                    }
                }
                )
                showDisplay()
             }


            function doDelete(thisElem){
                var tableElement = document.getElementById('bookTable');
                var rowElement = thisElem.parentNode.parentNode;
                var index = rowElement.rowIndex;
                ISBN = rowElement.getAttribute("id");
                $.ajax({
                    url:"http://127.0.0.1:5000/books/"+ISBN,
                    method : "DELETE",
                    dataType:"JSON",
                    success:function(results){
                        tableElement.deleteRow(index);
                    },
                    error:function(xhr, status, error){
                        console.log(error)
                    }
                }
                )
             }


             function showDisplay(){
                document.getElementById('display').style.display = "block"
                document.getElementById('create-update').style.display = "none"
             }


            function populateTable(){
                //ajax get all
                $.ajax({
                    url:'http://127.0.0.1:5000/books',
                    method:'GET',
                    dataType:'JSON',
                    success:function(results){
                        for (book of results){
                            addbookToTable(book)

                        }
                    }
                })                 
            }
    

            function getBookFromForm(){
                var form = document.getElementById('createUpdateForm')
                book={}
                book.ISBN = form.querySelector('input[name="ISBN"]').value
                book.title = form.querySelector('input[name="title"]').value
                book.author = form.querySelector('input[name="author"]').value
                book.price = form.querySelector('input[name="price"]').value
                return book
            }


            function addbookToTable(book){
                tableElem = document.getElementById("bookTable")
                rowElem = tableElem.insertRow(-1)
                rowElem.setAttribute("id",book.ISBN)
                cell1 = rowElem.insertCell(0)
                cell1.innerHTML = book.ISBN
                cell2 = rowElem.insertCell(1)
                cell2.innerHTML = book.title
                cell3 = rowElem.insertCell(2)
                cell3.innerHTML = book.author
                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = book.price
                cell5 = rowElem.insertCell(4)
                cell5.innerHTML = '<button onclick="showUpdate(this)">Update</button>'
                cell6 = rowElem.insertCell(5)
                cell6.innerHTML = '<button onclick="doDelete(this)">Delete</button>'
            }

            populateTable()
            
         </script>  
        </body>
    </head>
</html>