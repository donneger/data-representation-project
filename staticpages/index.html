<html>
    <head>
        <style>

            body {
                background-image: url('https://i2.wp.com/balanced.training/wp-content/uploads/2016/11/Gym-Background.jpg?ssl=1');
                background-size: cover;
            }

            table, th, td {
            border: 1px solid black;
            padding: 5px;
            }
            h2 {text-align: center;}
        </style>
        <body>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        
        <div id="create-update" style="display: none">
            <h2>Create-Edit</h2>
            <table id="createUpdateForm">
                <tr>
                   <td>id</td>
                   <td><inPut type = "text" name="id" id ="idInput"></td>
                </tr>
                <tr>
                   <td>Member Name</td>
                   <td><inPut type = "text" name="membername"></td>
                </tr>
                <tr>
                   <td>Age</td>
                   <td><inPut type = "text" name="age"></td>
                </tr>
                <tr>
                   <td>Class</td>
                   <td><inPut type = "text" name="class"></td>
                </tr>
                <tr>
                    <td>Class Date</td>
                    <td><inPut type = "date" name="classdate"></td>
                 </tr>
                 <tr>
                    <td>Class Time</td>
                    <td><inPut type = "time" name="classtime"></td>
                 </tr>
                 <tr>
                    <td>Instructor</td>
                    <td><inPut type = "text" name="Instructor"></td>
                 </tr>
                <tr>
                   <td></td><td><button id ="create-button" onclick="doCreate()">Create</button></td>
                   <td></td><td><button id ="update-button" onclick="doUpdate()">Update</button></td>
                </tr>
            </table>  
        </div> 
         <div id="display">
             <h2>Gym Bookings System</h2>
             <button onclick="showCreate()">Create Class Booking</button>
             <p></p>
             <table id = "bookingTable" style="width:70%">
                <tr>
                    <th>id</th><th>Member Name</th><th>Age</th><th>Class</th><th>Class Date</th><th>Class Time</th><th>Instructor</th><th><th></th></th>
                </tr>
                
            </table>
         </div> 
         <script>
             function showCreate(){
                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "none"
                document.getElementById('create-button').style.display = "block"
                document.getElementById('create-update').style.display = "block"
             }


             function showUpdate(thisElem){
                var rowElement = thisElem.parentNode.parentNode;
                booking = readBookingFromRow(rowElement)
                populateForm(booking)
                
                document.getElementById('display').style.display = "none"
                document.getElementById('update-button').style.display = "block"
                document.getElementById('create-button').style.display = "none"
                document.getElementById('create-update').style.display = "block"
             }
    

             function readBookingFromRow(rowElement){
                booking={}
                booking.id = rowElement.getAttribute("id");
                booking.membername = rowElement.cells[1].firstChild.textContent
                booking.age = rowElement.cells[2].firstChild.textContent
                booking.class = rowElement.cells[3].firstChild.textContent
                booking.classdate = rowElement.cells[4].firstChild.textContent
                booking.classtime = rowElement.cells[4].firstChild.textContent
                booking.instructor = rowElement.cells[6].firstChild.textContent
                return booking
             }


            function doUpdate(){
                booking = getBookFromForm()
                updateServer(booking)              
            }


            function updateServer(booking){
                $.ajax({
                    url:'http://127.0.0.1:5000/gymbooking/'+booking.id,
                    data:JSON.stringify(booking),
                    method:'PUT',
                    dataType:'JSON',
                    contentType:"application/json; charset=utf-8",
                    success:function(results){
                        console.log("update", results)
                        updateTableRow(booking)
                        showDisplay()
                        clearForm()
                    },
                    error:function(xhr, status, error){
                            console.log("error"+error)
                    }
                }
                )       
            }


            function updateTableRow(booking){
                rowElement = document.getElementById(booking.id)
                rowElement.cells[1].firstChild.textContent = booking.membername
                rowElement.cells[2].firstChild.textContent = booking.age
                rowElement.cells[3].firstChild.textContent = booking.class
                rowElement.cells[4].firstChild.textContent = booking.classdate
                rowElement.cells[5].firstChild.textContent = booking.classtime
                rowElement.cells[6].firstChild.textContent = booking.instructor
            }


             function populateForm(booking){
                var form = document.getElementById('createUpdateForm')
                form.querySelector('input[name="id"]').value = booking.id
                form.querySelector('input[name="id"]').disabled = true
                form.querySelector('input[name="membername"]').value = booking.membername
                form.querySelector('input[name="age"]').value = booking.age
                form.querySelector('input[name="class"]').value = booking.class
                form.querySelector('input[name="classdate"]').value = booking.classdate
                form.querySelector('input[name="classtime"]').value = booking.classtime
                form.querySelector('input[name="instructor"]').value = booking.instructor
             }


             function clearForm(){
                var form = document.getElementById('createUpdateForm')
                form.querySelector('input[name="id"]').value = ''
                form.querySelector('input[name="id"]').disabled = false
                form.querySelector('input[name="membername"]').value = ''
                form.querySelector('input[name="age"]').value = ''
                form.querySelector('input[name="class"]').value = ''
                form.querySelector('input[name="classdate"]').value = ''
                form.querySelector('input[name="classtime"]').value = ''
                form.querySelector('input[name="instructor"]').value = ''
             }

             function doCreate(){
                booking = getBookFromForm()
                $.ajax({
                    url:'http://127.0.0.1:5000/gymbooking',
                    data:JSON.stringify(booking),
                    method:'POST',
                    dataType:'JSON',
                    contentType:"application/json; charset=utf-8",
                    success:function(results){
                        addbookToTable(booking)
                        showDisplay()
                        clearForm()
                    },
                    error:function(xhr, ststus, error){
                            console.log("error"+error)
                    }
                }
                )
                showDisplay()
             }


            function doDelete(thisElem){
                var tableElement = document.getElementById('bookTable');
                var rowElement = thisElem.parentNode.parentNode;
                var index = rowElement.rowIndex;
                id = rowElement.getAttribute("id");
                $.ajax({
                    url:"http://127.0.0.1:5000/gymbooking/"+id,
                    method : "DELETE",
                    dataType:"JSON",
                    success:function(results){
                        tableElement.deleteRow(index);
                    },
                    error:function(xhr, status, error){
                        console.log(error)
                    }
                }
                )
             }


             function showDisplay(){
                document.getElementById('display').style.display = "block"
                document.getElementById('create-update').style.display = "none"
             }


            function populateTable(){
                //ajax get all
                $.ajax({
                    url:'http://127.0.0.1:5000/gymbooking',
                    method:'GET',
                    dataType:'JSON',
                    success:function(results){
                        for (booking of results){
                            addbookToTable(booking)

                        }
                    }
                })                 
            }
    

            function getBookFromForm(){
                var form = document.getElementById('createUpdateForm')
                booking={}
                booking.id = form.querySelector('input[name="id"]').value
                booking.membername = form.querySelector('input[name="membername"]').value
                booking.age = form.querySelector('input[name="age"]').value
                booking.class = form.querySelector('input[name="class"]').value
                booking.classdate = form.querySelector('input[name="classdate"]').value
                booking.classtime = form.querySelector('input[name="classtime"]').value
                booking.instructor = form.querySelector('input[name="instructor"]').value
                return booking
            }


            function addbookingToTable(booking){
                tableElem = document.getElementById("bookingTable")
                rowElem = tableElem.insertRow(-1)
                rowElem.setAttribute("id",booking.id)
                cell1 = rowElem.insertCell(0)
                cell1.innerHTML = booking.id
                cell2 = rowElem.insertCell(1)
                cell2.innerHTML = booking.membername
                cell3 = rowElem.insertCell(2)
                cell3.innerHTML = booking.age
                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = booking.class
                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = booking.classdate
                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = booking.classtime
                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = booking.instructor
                cell5 = rowElem.insertCell(4)
                cell5.innerHTML = '<button onclick="showUpdate(this)">Update Booking</button>'
                cell6 = rowElem.insertCell(5)
                cell6.innerHTML = '<button onclick="doDelete(this)">Delete Booking</button>'
            }

            populateTable()
            
         </script>  
        </body>
    </head>
</html>